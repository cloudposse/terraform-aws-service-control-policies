- sid: "ProtectS3Buckets"
  effect: "Deny"
  actions:
    - "s3:DeleteBucket"
    - "s3:DeleteObject"
    - "s3:DeleteObjectVersion"
  resources:
    - "*"


- sid: "DenyS3BucketsPublicAccess"
  effect: "Deny"
  actions:
    - "s3:PutBucketPublicAccessBlock"
    - "s3:DeletePublicAccessBlock"
  resources:
    - "*"


- sid: "DenyS3IncorrectEncryptionHeader"
  effect: "Deny"
  actions:
    - "s3:PutObject"
  condition:
    - test: "StringNotEquals"
      variable: "s3:x-amz-server-side-encryption"
      values:
        - "AES256"
        - "aws:kms"
  resources:
    - "*"

- sid: "DenyS3UnEncryptedObjectUploads"
  effect: "Deny"
  actions:
    - "s3:PutObject"
  condition:
    - test: "Null"
      variable: "s3:x-amz-server-side-encryption"
      values:
        - true
  resources:
    - "*"

- sid: "DenyNoTLSRequests"
  effect: "Deny"
  actions:
    - s"s3:*"
  condition:
    - test: "Bool"
      variable: "aws:SecureTransport"
      values:
        - false
  resources:
    - "arn:aws:s3:::*/*"

- sid: "RequireMFAS3Delete"
  effect: "Deny"
  actions:
    - "s3:DeleteObject"
  condition:
    - test: "BoolIfExists"
      variable: "aws:MultiFactorAuthPresent"
      values:
        - false
  resources:
    - "arn:aws:s3:::*/*"

- sid: "S3RegionLockdown"
  effect: "Deny"
  actions:
    - "s3:CreateBucket"
  condition:
    - test: "StringNotLike"
      variable: "s3locationconstraint"
      values:
        - ${region1_lockdown}
        - ${region2_lockdown}
    - test: "Null"
      variable: "s3locationconstraint"
      values:
        - false
  resources:
    - "arn:aws:s3:::*"
